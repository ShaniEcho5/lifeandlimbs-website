<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Life and Limb CMS</title>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
  <!-- Include the script that builds the page and powers Decap CMS -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  
  <script>
    // Initialize Decap CMS
    CMS.init({
      config: {
        // Configuration will be loaded from config.yml
      }
    });

    // Custom preview template for blog posts
    CMS.registerPreviewTemplate('posts', ({ entry, widgetFor, getAsset }) => {
      const data = entry.getIn(['data']).toJS();
      const body = widgetFor('body');
      const banner = getAsset(data.banner);
      
      return `
        <div style="max-width: 800px; margin: 0 auto; padding: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
          ${banner ? `<img src="${banner}" alt="${data.title}" style="width: 100%; height: 300px; object-fit: cover; border-radius: 8px; margin-bottom: 20px;">` : ''}
          <h1 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; color: #1a1a1a;">${data.title}</h1>
          <p style="color: #666; margin-bottom: 10px;">${data.date}</p>
          <p style="color: #666; font-style: italic; margin-bottom: 30px;">${data.description}</p>
          <div style="line-height: 1.6; color: #333;">
            ${body}
          </div>
        </div>
      `;
    });

    // Custom editor components
    CMS.registerEditorComponent({
      id: "image",
      label: "Image",
      fields: [
        { name: "src", label: "Image URL", widget: "image" },
        { name: "alt", label: "Alt Text", widget: "string" },
        { name: "caption", label: "Caption", widget: "string", required: false }
      ],
      pattern: /^!\[([^\]]*)\]\(([^\)]+)\)(?:\s*"([^"]*)")?$/,
      fromBlock: function(match) {
        return {
          alt: match[1],
          src: match[2],
          caption: match[3]
        };
      },
      toBlock: function(obj) {
        return `![${obj.alt}](${obj.src})${obj.caption ? ` "${obj.caption}"` : ''}`;
      },
      toPreview: function(obj) {
        return `<figure style="margin: 20px 0;">
          <img src="${obj.src}" alt="${obj.alt}" style="width: 100%; height: auto; border-radius: 4px;">
          ${obj.caption ? `<figcaption style="text-align: center; font-style: italic; color: #666; margin-top: 5px;">${obj.caption}</figcaption>` : ''}
        </figure>`;
      }
    });

    // Custom styles for the CMS interface
    CMS.registerPreviewStyle(`
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }
      
      h1, h2, h3, h4, h5, h6 {
        font-weight: 700;
        line-height: 1.3;
        margin-top: 30px;
        margin-bottom: 15px;
      }
      
      h1 { font-size: 2.5rem; }
      h2 { font-size: 2rem; }
      h3 { font-size: 1.5rem; }
      
      p {
        line-height: 1.7;
        margin-bottom: 15px;
      }
      
      blockquote {
        border-left: 4px solid #0073aa;
        margin: 20px 0;
        padding: 10px 20px;
        background: #f8f9fa;
        font-style: italic;
      }
      
      pre {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        padding: 15px;
        overflow-x: auto;
        margin: 20px 0;
      }
      
      code {
        background: #f8f9fa;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: Monaco, Consolas, monospace;
      }
      
      img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin: 20px 0;
      }
    `);
  </script>
</body>
</html>